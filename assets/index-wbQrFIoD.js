import{n as e}from"./rolldown-runtime-y2wrX6ue.js";import{A as t,C as n,D as r,E as i,M as a,O as o,S as s,T as c,_ as l,a as u,b as d,c as f,d as p,f as m,g as h,h as g,i as _,j as v,k as y,l as b,m as x,n as S,o as C,p as w,r as T,s as E,t as D,u as O,v as k,w as A,x as j,y as M}from"./vendor-D5cpj-C_.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var N=v(),P=e(a(),1),F=D(),I={apiKey:`AIzaSyDkRBknBGFNGZ-QLWKvbPf9nJZy2dxN45I`,authDomain:`my-dashboard-c434c.firebaseapp.com`,projectId:`my-dashboard-c434c`,storageBucket:`my-dashboard-c434c.firebasestorage.app`,messagingSenderId:`183916835818`,appId:`1:183916835818:web:8eeefa146fe87e44a27893`},L,R;try{let e=t(I);L=i(e),R=M(e)}catch{console.warn(`Firebase 初始化失败`)}var z=({children:e,className:t=``})=>(0,F.jsx)(`div`,{className:`bg-white/80 backdrop-blur-md rounded-2xl shadow-lg border border-white/20 p-6 ${t}`,children:e}),B=({onClick:e,children:t,variant:n=`primary`,className:r=``,disabled:i=!1})=>(0,F.jsx)(`button`,{onClick:e,disabled:i,className:`px-4 py-2 rounded-xl font-medium transition-all duration-200 flex items-center gap-2 active:scale-95 ${{primary:`bg-blue-600 text-white hover:bg-blue-700 shadow-blue-200 shadow-md`,secondary:`bg-gray-100 text-gray-700 hover:bg-gray-200`,danger:`bg-red-50 text-red-600 hover:bg-red-100`,ghost:`hover:bg-gray-100 text-gray-600`}[n]} ${i?`opacity-50 cursor-not-allowed`:``} ${r}`,children:t}),V=({weather:e,settings:t,targetName:n,daysLeft:r,targetDate:i,announcements:a,user:o,onDelete:s,onPost:c,newAnnouncement:l,setNewAnnouncement:u,onLogin:d})=>(0,F.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-3 gap-6 animate-fade-in`,children:[(0,F.jsxs)(`div`,{className:`space-y-6`,children:[(0,F.jsxs)(z,{className:`bg-gradient-to-br from-blue-500 to-blue-600 text-white border-none`,children:[(0,F.jsxs)(`div`,{className:`flex justify-between items-start`,children:[(0,F.jsxs)(`div`,{children:[(0,F.jsxs)(`h3`,{className:`text-blue-100 font-medium flex items-center gap-2`,children:[(0,F.jsx)(p,{size:18}),` 今日天气`]}),(0,F.jsx)(`p`,{className:`text-xs text-blue-200 mt-1`,children:t.city})]}),(0,F.jsxs)(`div`,{className:`text-4xl font-bold`,children:[e?Math.round(e.current.temperature_2m):`--`,`°`]})]}),(0,F.jsxs)(`div`,{className:`mt-6 flex justify-between text-sm text-blue-100`,children:[(0,F.jsxs)(`span`,{children:[`最高: `,e?e.daily.temperature_2m_max[0]:`--`,`°`]}),(0,F.jsxs)(`span`,{children:[`最低: `,e?e.daily.temperature_2m_min[0]:`--`,`°`]})]})]}),(0,F.jsxs)(z,{className:`bg-gradient-to-br from-purple-500 to-pink-600 text-white border-none`,children:[(0,F.jsxs)(`div`,{className:`flex justify-between items-center`,children:[(0,F.jsxs)(`h3`,{className:`text-purple-100 font-medium flex items-center gap-2`,children:[(0,F.jsx)(m,{size:18}),` `,n]}),(0,F.jsx)(`span`,{className:`text-xs bg-white/20 px-2 py-1 rounded text-white`,children:`目标日`})]}),(0,F.jsxs)(`div`,{className:`mt-4 text-center`,children:[(0,F.jsx)(`span`,{className:`text-5xl font-bold`,children:r}),(0,F.jsx)(`span`,{className:`ml-2 text-purple-200`,children:`天`})]}),(0,F.jsx)(`div`,{className:`mt-4 text-xs text-center text-purple-200`,children:i})]})]}),(0,F.jsx)(`div`,{className:`md:col-span-2`,children:(0,F.jsxs)(z,{className:`h-full flex flex-col`,children:[(0,F.jsxs)(`div`,{className:`flex justify-between items-center mb-6`,children:[(0,F.jsxs)(`h2`,{className:`text-xl font-bold text-gray-800 flex items-center gap-2`,children:[(0,F.jsx)(w,{className:`text-blue-500`}),` 公告栏`]}),o&&(0,F.jsxs)(`span`,{className:`text-xs text-gray-400`,children:[`作为 `,o.displayName,` 登录`]})]}),(0,F.jsxs)(`div`,{className:`flex-1 overflow-y-auto space-y-4 pr-2 min-h-[200px]`,children:[a.map(e=>(0,F.jsxs)(`div`,{className:`group p-4 rounded-xl bg-gray-50 hover:bg-blue-50 transition-colors border border-gray-100`,children:[(0,F.jsxs)(`div`,{className:`flex justify-between items-start`,children:[(0,F.jsx)(`p`,{className:`text-gray-700 whitespace-pre-wrap`,children:e.text}),o&&e.uid===o.uid&&(0,F.jsx)(`button`,{onClick:()=>s(e.id),className:`text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity`,children:(0,F.jsx)(S,{size:16})})]}),(0,F.jsxs)(`div`,{className:`mt-2 flex justify-between items-center`,children:[(0,F.jsx)(`span`,{className:`text-xs text-gray-400`,children:e.createdAt?.seconds?new Date(e.createdAt.seconds*1e3).toLocaleDateString():`刚刚`}),e.author&&(0,F.jsxs)(`span`,{className:`text-xs font-medium text-blue-500`,children:[`@`,e.author]})]})]},e.id)),a.length===0&&(0,F.jsx)(`div`,{className:`text-center text-gray-400 py-10`,children:`暂无公告`})]}),o?(0,F.jsx)(`div`,{className:`mt-6 pt-4 border-t border-gray-100`,children:(0,F.jsxs)(`div`,{className:`flex gap-2`,children:[(0,F.jsx)(`input`,{type:`text`,value:l,onChange:e=>u(e.target.value),placeholder:`发布新动态...`,className:`flex-1 bg-gray-100 border-none rounded-xl px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none transition-all`,onKeyDown:e=>e.key===`Enter`&&c()}),(0,F.jsx)(B,{onClick:c,children:(0,F.jsx)(E,{size:20})})]})}):(0,F.jsx)(`div`,{className:`mt-6 pt-4 border-t border-gray-100 text-center`,children:(0,F.jsx)(B,{variant:`secondary`,onClick:d,className:`w-full justify-center`,children:`登录以发布公告`})})]})})]}),H=({user:e,onLogin:t,settings:n,setSettings:r,targetName:i,setTargetName:a,targetDate:o,setTargetDate:s,onSave:c,loading:l})=>(0,F.jsx)(`div`,{className:`max-w-2xl mx-auto animate-fade-in`,children:(0,F.jsxs)(z,{children:[(0,F.jsxs)(`h2`,{className:`text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2`,children:[(0,F.jsx)(u,{className:`text-blue-500`}),` 自动化设置`]}),e?(0,F.jsxs)(`div`,{className:`space-y-6`,children:[(0,F.jsxs)(`div`,{className:`bg-blue-50 p-4 rounded-xl text-sm text-blue-700 flex gap-2`,children:[(0,F.jsx)(O,{className:`shrink-0`,size:18}),`此处保存的设置将用于 GitHub Actions 每日邮件推送。`]}),(0,F.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-4`,children:[(0,F.jsxs)(`div`,{children:[(0,F.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-1`,children:`所在城市 (Pinyin)`}),(0,F.jsx)(`input`,{type:`text`,value:n.city,onChange:e=>r({...n,city:e.target.value}),className:`w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none`})]}),(0,F.jsxs)(`div`,{children:[(0,F.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-1`,children:`接收邮箱`}),(0,F.jsx)(`input`,{type:`email`,value:n.emailAddress,placeholder:`example@gmail.com`,onChange:e=>r({...n,emailAddress:e.target.value}),className:`w-full p-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none`})]})]}),(0,F.jsxs)(`div`,{className:`space-y-4 border-t border-gray-100 pt-4`,children:[(0,F.jsxs)(`h3`,{className:`font-medium text-gray-900 flex items-center gap-2`,children:[(0,F.jsx)(T,{size:18}),` 温度预警阈值`]}),(0,F.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-4`,children:[(0,F.jsxs)(`div`,{children:[(0,F.jsx)(`label`,{className:`block text-sm text-gray-600 mb-1`,children:`高温提醒 (> X°C)`}),(0,F.jsx)(`input`,{type:`number`,value:n.tempHighThreshold,onChange:e=>r({...n,tempHighThreshold:parseInt(e.target.value)||0}),className:`w-full p-2 rounded-lg border border-gray-300`})]}),(0,F.jsxs)(`div`,{children:[(0,F.jsx)(`label`,{className:`block text-sm text-gray-600 mb-1`,children:`低温提醒 (< X°C)`}),(0,F.jsx)(`input`,{type:`number`,value:n.tempLowThreshold,onChange:e=>r({...n,tempLowThreshold:parseInt(e.target.value)||0}),className:`w-full p-2 rounded-lg border border-gray-300`})]})]})]}),(0,F.jsxs)(`div`,{className:`space-y-4 border-t border-gray-100 pt-4`,children:[(0,F.jsxs)(`h3`,{className:`font-medium text-gray-900 flex items-center gap-2`,children:[(0,F.jsx)(m,{size:18}),` 倒数日事件`]}),(0,F.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-4`,children:[(0,F.jsxs)(`div`,{children:[(0,F.jsx)(`label`,{className:`block text-sm text-gray-600 mb-1`,children:`事件名称`}),(0,F.jsx)(`input`,{type:`text`,value:i,onChange:e=>a(e.target.value),className:`w-full p-2 rounded-lg border border-gray-300`})]}),(0,F.jsxs)(`div`,{children:[(0,F.jsx)(`label`,{className:`block text-sm text-gray-600 mb-1`,children:`目标日期`}),(0,F.jsx)(`input`,{type:`date`,value:o,onChange:e=>s(e.target.value),className:`w-full p-2 rounded-lg border border-gray-300`})]})]})]}),(0,F.jsx)(`div`,{className:`pt-4`,children:(0,F.jsxs)(B,{onClick:c,disabled:l,className:`w-full justify-center`,children:[l?`保存中...`:`保存所有设置`,` `,(0,F.jsx)(C,{size:18})]})})]}):(0,F.jsxs)(`div`,{className:`text-center py-10`,children:[(0,F.jsx)(`p`,{className:`text-gray-500 mb-4`,children:`请先登录以同步您的偏好设置到云端。`}),(0,F.jsx)(B,{onClick:t,className:`mx-auto`,children:`立即登录`})]})]})}),U=()=>(0,F.jsx)(`div`,{className:`max-w-2xl mx-auto animate-fade-in`,children:(0,F.jsxs)(z,{children:[(0,F.jsx)(`h1`,{className:`text-3xl font-bold text-gray-800 mb-4`,children:`关于本站`}),(0,F.jsxs)(`div`,{className:`prose text-gray-600 space-y-4`,children:[(0,F.jsxs)(`p`,{children:[`这是一个基于 `,(0,F.jsx)(`strong`,{children:`React + Firebase + GitHub Pages`}),` 构建的个人智能仪表盘。`]}),(0,F.jsxs)(`ul`,{className:`list-disc pl-5 space-y-2`,children:[(0,F.jsx)(`li`,{children:`前端使用 React 构建，界面采用 Tailwind CSS 设计。`}),(0,F.jsx)(`li`,{children:`数据存储在 Google Firebase (Firestore) 中，实现实时同步。`}),(0,F.jsxs)(`li`,{children:[(0,F.jsx)(`strong`,{children:`GitHub Actions 自动化：`}),`后台每天会自动运行脚本，读取你的设置。如果明天气温超过你在设置页面设定的阈值，或者距离倒数日还有3天，系统会自动向你的邮箱发送提醒。`]})]}),(0,F.jsxs)(`div`,{className:`mt-8 p-4 bg-gray-100 rounded-xl`,children:[(0,F.jsx)(`h3`,{className:`font-bold text-gray-800 mb-2`,children:`项目状态`}),(0,F.jsxs)(`div`,{className:`flex items-center gap-2 text-green-600`,children:[(0,F.jsx)(`span`,{className:`w-2 h-2 rounded-full bg-green-500 animate-pulse`}),`系统运行正常`]})]})]})]})});function W(){let[e,t]=(0,P.useState)(null),[i,a]=(0,P.useState)(`dashboard`),[p,m]=(0,P.useState)(null),[v,S]=(0,P.useState)([]),[C,w]=(0,P.useState)(``),[T,E]=(0,P.useState)(`2025-01-01`),[D,M]=(0,P.useState)(`新年`),[N,I]=(0,P.useState)({city:`Beijing`,tempHighThreshold:30,tempLowThreshold:10,emailAlerts:!0,emailAddress:``}),[z,W]=(0,P.useState)(!1);(0,P.useEffect)(()=>{if(!L)return;let e=r(L,e=>{t(e),e&&Y(e.uid)});return()=>e()},[]),(0,P.useEffect)(()=>{if(!R)return;let e=j(n(g(R,`announcements`),s(`createdAt`,`desc`),d(5)),e=>{S(e.docs.map(e=>({id:e.id,...e.data()})))},e=>{S([{id:1,text:`欢迎来到你的个人仪表盘！请配置 Firebase 以启用实时功能。`,createdAt:{seconds:Date.now()/1e3}},{id:2,text:`今天记得带伞，可能会有雨。`,createdAt:{seconds:(Date.now()-864e5)/1e3}}])});return()=>e()},[]),(0,P.useEffect)(()=>{(async()=>{try{m(await(await fetch(`https://api.open-meteo.com/v1/forecast?latitude=39.9042&longitude=116.4074&current=temperature_2m,relative_humidity_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FShanghai`)).json())}catch(e){console.error(`天气获取失败`,e)}})()},[N.city]);let G=async()=>{if(!L){alert(`请先在代码中配置 Firebase!`);return}let e=new c;try{await o(L,e)}catch(e){console.error(`登录失败`,e)}},K=()=>L&&y(L),q=async()=>{if(!(!C.trim()||!R))try{await x(g(R,`announcements`),{text:C,author:e.displayName,uid:e.uid,createdAt:new Date}),w(``)}catch{alert(`发布失败: 权限不足或配置错误`)}},J=async e=>{if(R)try{await h(l(R,`announcements`,e))}catch(e){console.error(`删除失败`,e)}},Y=async e=>{if(R)try{let t=await k(l(R,`users`,e));t.exists()&&(I({...N,...t.data()}),t.data().targetDate&&E(t.data().targetDate),t.data().targetName&&M(t.data().targetName))}catch(e){console.error(`获取设置失败`,e)}};return(0,F.jsxs)(`div`,{className:`min-h-screen bg-[#f3f4f6] text-gray-800 font-sans selection:bg-blue-200`,children:[(0,F.jsxs)(`nav`,{className:`sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-gray-200 px-4 py-3 shadow-sm`,children:[(0,F.jsxs)(`div`,{className:`max-w-6xl mx-auto flex justify-between items-center`,children:[(0,F.jsxs)(`div`,{className:`flex items-center gap-2 font-bold text-xl text-blue-600`,children:[(0,F.jsx)(`div`,{className:`p-2 bg-blue-100 rounded-lg`,children:(0,F.jsx)(_,{size:20,className:`text-blue-600`})}),`MySpace`]}),(0,F.jsx)(`div`,{className:`hidden md:flex gap-1 bg-gray-100 p-1 rounded-xl`,children:[{id:`dashboard`,label:`概览`,icon:_},{id:`settings`,label:`设置`,icon:u},{id:`about`,label:`关于`,icon:O}].map(e=>(0,F.jsxs)(`button`,{onClick:()=>a(e.id),className:`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-all ${i===e.id?`bg-white text-blue-600 shadow-sm`:`text-gray-500 hover:text-gray-700`}`,children:[(0,F.jsx)(e.icon,{size:16}),e.label]},e.id))}),(0,F.jsx)(`div`,{children:e?(0,F.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,F.jsx)(`img`,{src:e.photoURL||`https://api.dicebear.com/7.x/avataaars/svg?seed=Felix`,alt:`Avatar`,className:`w-8 h-8 rounded-full border border-gray-200`}),(0,F.jsx)(B,{variant:`ghost`,onClick:K,className:`!px-2`,children:(0,F.jsx)(f,{size:18})})]}):(0,F.jsxs)(B,{onClick:G,variant:`primary`,className:`text-sm`,children:[(0,F.jsx)(b,{size:16}),` 登录`]})})]}),(0,F.jsx)(`div`,{className:`md:hidden flex justify-around mt-3 pt-2 border-t border-gray-100`,children:[{id:`dashboard`,label:`概览`},{id:`settings`,label:`设置`},{id:`about`,label:`关于`}].map(e=>(0,F.jsx)(`button`,{onClick:()=>a(e.id),className:`text-sm font-medium ${i===e.id?`text-blue-600`:`text-gray-500`}`,children:e.label},e.id))})]}),(0,F.jsxs)(`main`,{className:`max-w-6xl mx-auto p-4 md:p-6 mt-4 mb-10`,children:[i===`dashboard`&&(0,F.jsx)(V,{weather:p,settings:N,targetName:D,daysLeft:(()=>{let e=new Date(T)-new Date,t=Math.ceil(e/(1e3*60*60*24));return t>0?t:0})(),targetDate:T,announcements:v,user:e,onDelete:J,onPost:q,newAnnouncement:C,setNewAnnouncement:w,onLogin:G}),i===`settings`&&(0,F.jsx)(H,{user:e,onLogin:G,settings:N,setSettings:I,targetName:D,setTargetName:M,targetDate:T,setTargetDate:E,onSave:async()=>{if(!(!e||!R)){W(!0);try{await A(l(R,`users`,e.uid),{...N,targetDate:T,targetName:D,updatedAt:new Date}),alert(`设置已保存！GitHub Actions 将在下次运行时使用这些配置。`)}catch{alert(`保存失败`)}finally{W(!1)}}},loading:z}),i===`about`&&(0,F.jsx)(U,{})]})]})}(0,N.createRoot)(document.getElementById(`root`)).render((0,F.jsx)(P.StrictMode,{children:(0,F.jsx)(W,{})}));